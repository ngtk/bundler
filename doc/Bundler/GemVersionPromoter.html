<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Bundler::GemVersionPromoter
  
    &mdash; Documentation by YARD 0.9.5
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "Bundler::GemVersionPromoter";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Bundler.html" title="Bundler (module)">Bundler</a></span></span>
     &raquo; 
    <span class="title">GemVersionPromoter</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <iframe id="search_frame" src="../class_list.html"></iframe>

      <div id="content"><h1>Class: Bundler::GemVersionPromoter
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Bundler::GemVersionPromoter</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/bundler/gem_version_promoter.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class contains all of the logic for determining the next version of a
Gem to update to based on the requested level (patch, minor, major).
Primarily designed to work with Resolver which will provide it the list of
available dependency versions as found in its index, before returning it to
to the resolution engine to select the best version.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#level-instance_method" title="#level (instance method)">#<strong>level</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute level.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#locked_specs-instance_method" title="#locked_specs (instance method)">#<strong>locked_specs</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute locked_specs.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#strict-instance_method" title="#strict (instance method)">#<strong>strict</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>By default, strict is false, meaning every available version of a gem is
returned from sort_versions.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#unlock_gems-instance_method" title="#unlock_gems (instance method)">#<strong>unlock_gems</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute unlock_gems.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(locked_specs = SpecSet.new([]), unlock_gems = [])  &#x21d2; GemVersionPromoter </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a list of locked_specs and a list of gems to unlock creates a
GemVersionPromoter instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#major%3F-instance_method" title="#major? (instance method)">#<strong>major?</strong>  &#x21d2; bool </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#minor%3F-instance_method" title="#minor? (instance method)">#<strong>minor?</strong>  &#x21d2; bool </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sort_versions-instance_method" title="#sort_versions (instance method)">#<strong>sort_versions</strong>(dep, spec_groups)  &#x21d2; SpecGroup </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given a Dependency and an Array of SpecGroups of available versions for a
gem, this method will return the Array of SpecGroups sorted (and possibly
truncated if strict is true) in an order to give preference to the current
level (:major, :minor or :patch) when resolution is deciding what versions
best resolve all dependencies in the bundle.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(locked_specs = SpecSet.new([]), unlock_gems = [])  &#x21d2; <tt><span class='object_link'><a href="" title="Bundler::GemVersionPromoter (class)">GemVersionPromoter</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a list of locked_specs and a list of gems to unlock creates a
GemVersionPromoter instance.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>locked_specs</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="SpecSet.html" title="Bundler::SpecSet (class)">SpecSet</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>SpecSet.new([])</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>All current locked specs. Unlike Definition where this list is empty if all
gems are being updated, this should always be populated for all gems so
this class can properly function.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>unlock_gems</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>[]</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>List of gem names being unlocked. If empty, all gems will be considered
unlocked.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35
36
37
38
39</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 33</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_locked_specs'>locked_specs</span> <span class='op'>=</span> <span class='const'>SpecSet</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_unlock_gems'>unlock_gems</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@level</span> <span class='op'>=</span> <span class='symbol'>:major</span>
  <span class='ivar'>@strict</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@locked_specs</span> <span class='op'>=</span> <span class='id identifier rubyid_locked_specs'>locked_specs</span>
  <span class='ivar'>@unlock_gems</span> <span class='op'>=</span> <span class='id identifier rubyid_unlock_gems'>unlock_gems</span>
  <span class='ivar'>@sort_versions</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="level=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="level-instance_method">
  
    #<strong>level</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute level</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_level'>level</span>
  <span class='ivar'>@level</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="locked_specs-instance_method">
  
    #<strong>locked_specs</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute locked_specs</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_locked_specs'>locked_specs</span>
  <span class='ivar'>@locked_specs</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="strict=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="strict-instance_method">
  
    #<strong>strict</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>By default, strict is false, meaning every available version of a gem is
returned from sort_versions. The order gives preference to the requested
level (:patch, :minor, :major) but in complicated requirement cases some
gems will by necessity by promoted past the requested level, or even
reverted to older versions.</p>

<p>If strict is set to true, the results from sort_versions will be truncated,
eliminating any version outside the current level scope. This can lead to
unexpected outcomes or even VersionConflict exceptions that report a
version of a gem not existing for versions that indeed do existing in the
referenced source.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 22</span>

<span class='kw'>def</span> <span class='id identifier rubyid_strict'>strict</span>
  <span class='ivar'>@strict</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="unlock_gems-instance_method">
  
    #<strong>unlock_gems</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute unlock_gems</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9
10
11</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 9</span>

<span class='kw'>def</span> <span class='id identifier rubyid_unlock_gems'>unlock_gems</span>
  <span class='ivar'>@unlock_gems</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="major?-instance_method">
  
    #<strong>major?</strong>  &#x21d2; <tt>bool</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Convenience method for testing value of level variable.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>bool</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 86</span>

<span class='kw'>def</span> <span class='id identifier rubyid_major?'>major?</span>
  <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='symbol'>:major</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="minor?-instance_method">
  
    #<strong>minor?</strong>  &#x21d2; <tt>bool</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Convenience method for testing value of level variable.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>bool</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Convenience method for testing value of level variable.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_minor?'>minor?</span>
  <span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='symbol'>:minor</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sort_versions-instance_method">
  
    #<strong>sort_versions</strong>(dep, spec_groups)  &#x21d2; <tt>SpecGroup</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given a Dependency and an Array of SpecGroups of available versions for a
gem, this method will return the Array of SpecGroups sorted (and possibly
truncated if strict is true) in an order to give preference to the current
level (:major, :minor or :patch) when resolution is deciding what versions
best resolve all dependencies in the bundle.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>dep</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Dependency.html" title="Bundler::Dependency (class)">Dependency</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The Dependency of the gem.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>spec_groups</span>
      
      
        <span class='type'>(<tt>SpecGroup</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>An array of SpecGroups for the same gem named in the @dep param.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>SpecGroup</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A new instance of the SpecGroup Array sorted and possibly filtered.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/bundler/gem_version_promoter.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sort_versions'>sort_versions</span><span class='lparen'>(</span><span class='id identifier rubyid_dep'>dep</span><span class='comma'>,</span> <span class='id identifier rubyid_spec_groups'>spec_groups</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_before_result'>before_result</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>before sort_versions: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_debug_format_result'>debug_format_result</span><span class='lparen'>(</span><span class='id identifier rubyid_dep'>dep</span><span class='comma'>,</span> <span class='id identifier rubyid_spec_groups'>spec_groups</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DEBUG_RESOLVER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='ivar'>@sort_versions</span><span class='lbracket'>[</span><span class='id identifier rubyid_dep'>dep</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='kw'>begin</span>
    <span class='id identifier rubyid_gem_name'>gem_name</span> <span class='op'>=</span> <span class='id identifier rubyid_dep'>dep</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>

    <span class='comment'># An Array per version returned, different entries for different platforms.
</span>    <span class='comment'># We only need the version here so it&#39;s ok to hard code this to the first instance.
</span>    <span class='id identifier rubyid_locked_spec'>locked_spec</span> <span class='op'>=</span> <span class='id identifier rubyid_locked_specs'>locked_specs</span><span class='lbracket'>[</span><span class='id identifier rubyid_gem_name'>gem_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_strict'>strict</span>
      <span class='id identifier rubyid_filter_dep_specs'>filter_dep_specs</span><span class='lparen'>(</span><span class='id identifier rubyid_spec_groups'>spec_groups</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_spec'>locked_spec</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_sort_dep_specs'>sort_dep_specs</span><span class='lparen'>(</span><span class='id identifier rubyid_spec_groups'>spec_groups</span><span class='comma'>,</span> <span class='id identifier rubyid_locked_spec'>locked_spec</span><span class='rparen'>)</span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_specs'>specs</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>DEBUG_RESOLVER</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='const'>STDERR</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_before_result'>before_result</span>
        <span class='const'>STDERR</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> after sort_versions: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_debug_format_result'>debug_format_result</span><span class='lparen'>(</span><span class='id identifier rubyid_dep'>dep</span><span class='comma'>,</span> <span class='id identifier rubyid_specs'>specs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sat Mar 18 19:39:43 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.5 (ruby-2.3.0).
</div>

    </div>
  </body>
</html>